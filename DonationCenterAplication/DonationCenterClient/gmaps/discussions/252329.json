[
  {
    "Id": "590963",
    "ThreadId": "252329",
    "Html": "\r\n<p>Hi,</p>\r\n<p>how can i use street view in windows forms with &nbsp;C# and .Net 4 ?</p>\r\n<p>I add&nbsp;PanoramaViewer to project but who can i &nbsp;add viewr control to windows forms ?</p>\r\n",
    "PostedDate": "2011-04-03T11:42:26.823-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "590965",
    "ThreadId": "252329",
    "Html": "<p>it's wpf control, i don't know much about hosting wpf in windows forms</p>",
    "PostedDate": "2011-04-03T11:46:35.27-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "590966",
    "ThreadId": "252329",
    "Html": "<p>if i can do this i postet here.</p>\r\n<p>;))</p>",
    "PostedDate": "2011-04-03T11:49:05.557-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "590989",
    "ThreadId": "252329",
    "Html": "<p>Can you help me.</p>\r\n<p>i add&nbsp;PanoramaViewer &nbsp;class to project and then do this.</p>\r\n<p>Please tell me where of this code is wrong ?</p>\r\n<p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre><span style=\"color: blue;\">using</span> System;\r\n<span style=\"color: blue;\">using</span> System.Collections.Generic;\r\n<span style=\"color: blue;\">using</span> System.ComponentModel;\r\n<span style=\"color: blue;\">using</span> System.Data;\r\n<span style=\"color: blue;\">using</span> System.Linq;\r\n<span style=\"color: blue;\">using</span> System.Text;\r\n<span style=\"color: blue;\">using</span> System.Windows.Forms;\r\n<span style=\"color: blue;\">using</span> System.IO;\r\n<span style=\"color: blue;\">using</span> System.Net;\r\n<span style=\"color: blue;\">using</span> System.Windows;\r\n<span style=\"color: blue;\">using</span> System.Windows.Controls;\r\n<span style=\"color: blue;\">using</span> System.Windows.Input;\r\n<span style=\"color: blue;\">using</span> System.Windows.Media;\r\n<span style=\"color: blue;\">using</span> System.Windows.Media.Imaging;\r\n\r\n<span style=\"color: blue;\">namespace</span> StreetViewSample\r\n{\r\n    <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">partial</span> <span style=\"color: blue;\">class</span> Form1 : Form\r\n    {\r\n         StreetViewSample.PanoramaViewer Viewer = <span style=\"color: blue;\">new</span> PanoramaViewer();\r\n        \r\n        BackgroundWorker loader = <span style=\"color: blue;\">new</span> BackgroundWorker();\r\n        StackPanel buff = <span style=\"color: blue;\">new</span> StackPanel();\r\n\r\n        <span style=\"color: blue;\">public</span> Form1()\r\n        {\r\n            InitializeComponent();\r\n\r\n            Viewer.MouseLeftButtonDown += <span style=\"color: blue;\">new</span> MouseButtonEventHandler(Viewer_MouseLeftButtonDown);\r\n            Viewer.MouseMove += <span style=\"color: blue;\">new</span> System.Windows.Input.MouseEventHandler(Viewer_MouseMove);\r\n            buff.Orientation = System.Windows.Controls.Orientation.Vertical;\r\n\r\n            <span style=\"color: green;\">// removes white lines between tiles!</span>\r\n            <span style=\"color: green;\">//DependencyObject.SetValue(RenderOptions.EdgeModeProperty, EdgeMode.Aliased);</span>\r\n            loader.DoWork += <span style=\"color: blue;\">new</span> DoWorkEventHandler(loader_DoWork);\r\n            loader.ProgressChanged += <span style=\"color: blue;\">new</span> ProgressChangedEventHandler(loader_ProgressChanged);\r\n            loader.RunWorkerCompleted += <span style=\"color: blue;\">new</span> RunWorkerCompletedEventHandler(loader_RunWorkerCompleted);\r\n            loader.WorkerReportsProgress = <span style=\"color: blue;\">true</span>;\r\n        }\r\n        <span style=\"color: blue;\">void</span> loader_RunWorkerCompleted(<span style=\"color: blue;\">object</span> sender, RunWorkerCompletedEventArgs e)\r\n        {\r\n            buff.UpdateLayout();\r\n\r\n            Canvas canvas = <span style=\"color: blue;\">new</span> Canvas();\r\n            canvas.Children.Add(buff);\r\n            canvas.Width = 512 * 13;\r\n            canvas.Height = 512 * 7;\r\n\r\n            canvas.UpdateLayout();\r\n\r\n            canvas.Measure(<span style=\"color: blue;\">new</span> Size((<span style=\"color: blue;\">int</span>)canvas.Width, (<span style=\"color: blue;\">int</span>)canvas.Height));\r\n            canvas.Arrange(<span style=\"color: blue;\">new</span> Rect(<span style=\"color: blue;\">new</span> Size((<span style=\"color: blue;\">int</span>)canvas.Width, (<span style=\"color: blue;\">int</span>)canvas.Height)));\r\n            <span style=\"color: blue;\">int</span> Height = ((<span style=\"color: blue;\">int</span>)(canvas.ActualHeight));\r\n            <span style=\"color: blue;\">int</span> Width = ((<span style=\"color: blue;\">int</span>)(canvas.ActualWidth));\r\n\r\n            RenderTargetBitmap _RenderTargetBitmap = <span style=\"color: blue;\">new</span> RenderTargetBitmap(Width, Height, 96, 96, PixelFormats.Pbgra32);\r\n            _RenderTargetBitmap.Render(buff);\r\n\r\n            Image img = <span style=\"color: blue;\">new</span> Image();\r\n            img.Source = _RenderTargetBitmap;\r\n\r\n            Viewer.PanoramaImage = _RenderTargetBitmap;\r\n\r\n            <span style=\"color: blue;\">this</span>.Text = <span style=\"color: #a31515;\">\"Demo.StreetView, enjoy! ;}\"</span>;\r\n        }\r\n\r\n        Vector RotationVector = <span style=\"color: blue;\">new</span> Vector();\r\n        Point DownPoint = <span style=\"color: blue;\">new</span> Point();\r\n        <span style=\"color: blue;\">void</span> Viewer_MouseMove(<span style=\"color: blue;\">object</span> sender,System.Windows.Input.MouseEventArgs e)\r\n        {\r\n            <span style=\"color: blue;\">if</span> (e.LeftButton == MouseButtonState.Released)\r\n                <span style=\"color: blue;\">return</span>;\r\n            Vector Offset = Point.Subtract(e.GetPosition(Viewer), DownPoint) * 0.25;\r\n\r\n            Viewer.RotationY = RotationVector.Y + Offset.X;\r\n            Viewer.RotationX = RotationVector.X - Offset.Y;\r\n        }\r\n\r\n        <span style=\"color: blue;\">void</span> Viewer_MouseLeftButtonDown(<span style=\"color: blue;\">object</span> sender, MouseButtonEventArgs e)\r\n        {\r\n            DownPoint = e.GetPosition(Viewer);\r\n            RotationVector.X = Viewer.RotationX;\r\n            RotationVector.Y = Viewer.RotationY;\r\n            <span style=\"color: blue;\">this</span>.Cursor = System.Windows.Forms.Cursors.SizeAll;\r\n        }\r\n\r\n        <span style=\"color: blue;\">private</span> <span style=\"color: blue;\">void</span> Viewer_MouseLeftButtonUp(<span style=\"color: blue;\">object</span> sender, MouseButtonEventArgs e)\r\n        {\r\n            <span style=\"color: blue;\">this</span>.Cursor = System.Windows.Forms.Cursors.Arrow;\r\n        }\r\n\r\n        <span style=\"color: blue;\">void</span> loader_ProgressChanged(<span style=\"color: blue;\">object</span> sender, ProgressChangedEventArgs e)\r\n        {\r\n            <span style=\"color: blue;\">if</span> (e.ProgressPercentage == 100)\r\n            {\r\n                Pass p = e.UserState <span style=\"color: blue;\">as</span> Pass;\r\n\r\n                <span style=\"color: blue;\">this</span>.Text = <span style=\"color: #a31515;\">\"Demo.StreetView, please wait on first time loading: \"</span> + p.X + <span style=\"color: #a31515;\">\"|\"</span> + p.Y + <span style=\"color: #a31515;\">\" of 13\"</span>;\r\n                Image i = <span style=\"color: blue;\">new</span> Image();\r\n\r\n                i.Source = p.src;\r\n                (buff.Children[buff.Children.Count - 1] <span style=\"color: blue;\">as</span> StackPanel).Children.Add(i);\r\n            }\r\n            <span style=\"color: blue;\">else</span> <span style=\"color: blue;\">if</span> (e.ProgressPercentage == 0)\r\n            {\r\n                <span style=\"color: blue;\">this</span>.Text = <span style=\"color: #a31515;\">\"Demo.StreetView, please wait on first time loading: zooming...\"</span>;\r\n\r\n                StackPanel ph = <span style=\"color: blue;\">new</span> StackPanel();\r\n                ph.Orientation = System.Windows.Controls.Orientation.Horizontal;\r\n                buff.Children.Add(ph);\r\n            }\r\n        }\r\n\r\n        <span style=\"color: blue;\">void</span> loader_DoWork(<span style=\"color: blue;\">object</span> sender, DoWorkEventArgs e)\r\n        {\r\n            <span style=\"color: blue;\">string</span> panoId = <span style=\"color: #a31515;\">\"rIcDg5NpZyolFR3i98C_3Q\"</span>;\r\n            <span style=\"color: blue;\">int</span> zoom = 4;\r\n\r\n            <span style=\"color: green;\">//0, 1</span>\r\n            <span style=\"color: green;\">//1, 2   </span>\r\n            <span style=\"color: green;\">//2, 4</span>\r\n            <span style=\"color: green;\">//3, 7   </span>\r\n            <span style=\"color: green;\">//4, 13  </span>\r\n            <span style=\"color: green;\">//5, 26  </span>\r\n\r\n            <span style=\"color: blue;\">for</span> (<span style=\"color: blue;\">int</span> y = 0; y &lt;= zoom + 1; y++)\r\n            {\r\n                loader.ReportProgress(0);\r\n\r\n                <span style=\"color: blue;\">for</span> (<span style=\"color: blue;\">int</span> x = 0; x &lt; 13; x++)\r\n                {\r\n                    Pass p = <span style=\"color: blue;\">new</span> Pass();\r\n                    p.Y = y;\r\n                    p.X = x;\r\n\r\n                    <span style=\"color: blue;\">string</span> fl = <span style=\"color: #a31515;\">\"Tiles\\\\\" + zoom + \"</span>\\\\<span style=\"color: #a31515;\">\" + panoId + \"</span>\\\\img_<span style=\"color: #a31515;\">\" + x + \"</span>_<span style=\"color: #a31515;\">\" + y + \"</span>.jpg\";\r\n                    <span style=\"color: blue;\">string</span> dr = System.IO.Path.GetDirectoryName(fl);\r\n                    <span style=\"color: blue;\">if</span> (!Directory.Exists(dr))\r\n                    {\r\n                        Directory.CreateDirectory(dr);\r\n                    }\r\n                    <span style=\"color: blue;\">if</span> (!File.Exists(fl))\r\n                    {\r\n                        ImageSource src = Get(<span style=\"color: blue;\">string</span>.Format(<span style=\"color: #a31515;\">\"http://cbk{0}.google.com/cbk?output=tile&amp;panoid={1}&amp;zoom={2}&amp;x={3}&amp;y={4}&amp;cb_client=maps_sv\"</span>, (x + 2 * y) % 3, panoId, zoom, x, y));\r\n                        p.src = src;\r\n                        SaveImg(src, fl);\r\n                    }\r\n                    <span style=\"color: blue;\">else</span>\r\n                    {\r\n                        <span style=\"color: blue;\">using</span> (Stream s = File.OpenRead(fl))\r\n                        {\r\n                            p.src = FromStream(s);\r\n                        }\r\n                    }\r\n\r\n                    loader.ReportProgress(100, p);\r\n                }\r\n            }\r\n\r\n            GC.Collect();\r\n            GC.WaitForPendingFinalizers();\r\n            GC.Collect();\r\n        }\r\n\r\n        <span style=\"color: blue;\">void</span> SaveImg(ImageSource src, <span style=\"color: blue;\">string</span> file)\r\n        {\r\n            <span style=\"color: blue;\">using</span> (Stream s = File.OpenWrite(file))\r\n            {\r\n                JpegBitmapEncoder e = <span style=\"color: blue;\">new</span> JpegBitmapEncoder();\r\n                e.Frames.Add(BitmapFrame.Create(src <span style=\"color: blue;\">as</span> BitmapSource));\r\n                e.Save(s);\r\n            }\r\n        }\r\n\r\n        <span style=\"color: blue;\">private</span> <span style=\"color: blue;\">void</span> Window_Loaded(<span style=\"color: blue;\">object</span> sender, RoutedEventArgs e)\r\n        {\r\n            loader.RunWorkerAsync();\r\n        }\r\n\r\n        <span style=\"color: blue;\">public</span> Stream CopyStream(Stream inputStream)\r\n        {\r\n            <span style=\"color: blue;\">const</span> <span style=\"color: blue;\">int</span> readSize = 256;\r\n            <span style=\"color: blue;\">byte</span>[] buffer = <span style=\"color: blue;\">new</span> <span style=\"color: blue;\">byte</span>[readSize];\r\n            MemoryStream ms = <span style=\"color: blue;\">new</span> MemoryStream();\r\n\r\n            <span style=\"color: blue;\">using</span> (inputStream)\r\n            {\r\n                <span style=\"color: blue;\">int</span> count = inputStream.Read(buffer, 0, readSize);\r\n                <span style=\"color: blue;\">while</span> (count &gt; 0)\r\n                {\r\n                    ms.Write(buffer, 0, count);\r\n                    count = inputStream.Read(buffer, 0, readSize);\r\n                }\r\n            }\r\n            buffer = <span style=\"color: blue;\">null</span>;\r\n            ms.Seek(0, SeekOrigin.Begin);\r\n            <span style=\"color: blue;\">return</span> ms;\r\n        }\r\n\r\n        ImageSource FromStream(Stream stream)\r\n        {\r\n            ImageSource ret = <span style=\"color: blue;\">null</span>;\r\n            <span style=\"color: blue;\">if</span> (stream != <span style=\"color: blue;\">null</span>)\r\n            {\r\n                {\r\n                    <span style=\"color: green;\">// try png decoder</span>\r\n                    <span style=\"color: blue;\">try</span>\r\n                    {\r\n                        JpegBitmapDecoder bitmapDecoder = <span style=\"color: blue;\">new</span> JpegBitmapDecoder(stream, BitmapCreateOptions.PreservePixelFormat, BitmapCacheOption.OnLoad);\r\n                        ImageSource m = bitmapDecoder.Frames[0];\r\n\r\n                        <span style=\"color: blue;\">if</span> (m != <span style=\"color: blue;\">null</span>)\r\n                        {\r\n                            ret = m;\r\n                        }\r\n                    }\r\n                    <span style=\"color: blue;\">catch</span>\r\n                    {\r\n                        ret = <span style=\"color: blue;\">null</span>;\r\n                    }\r\n\r\n                    <span style=\"color: green;\">// try jpeg decoder</span>\r\n                    <span style=\"color: blue;\">if</span> (ret == <span style=\"color: blue;\">null</span>)\r\n                    {\r\n                        <span style=\"color: blue;\">try</span>\r\n                        {\r\n                            stream.Seek(0, SeekOrigin.Begin);\r\n\r\n                            PngBitmapDecoder bitmapDecoder = <span style=\"color: blue;\">new</span> PngBitmapDecoder(stream, BitmapCreateOptions.PreservePixelFormat, BitmapCacheOption.OnLoad);\r\n                            ImageSource m = bitmapDecoder.Frames[0];\r\n\r\n                            <span style=\"color: blue;\">if</span> (m != <span style=\"color: blue;\">null</span>)\r\n                            {\r\n                                ret = m;\r\n                            }\r\n                        }\r\n                        <span style=\"color: blue;\">catch</span>\r\n                        {\r\n                            ret = <span style=\"color: blue;\">null</span>;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            <span style=\"color: blue;\">return</span> ret;\r\n        }\r\n\r\n        ImageSource Get(<span style=\"color: blue;\">string</span> url)\r\n        {\r\n            ImageSource ret = <span style=\"color: blue;\">null</span>;\r\n            <span style=\"color: blue;\">try</span>\r\n            {\r\n                HttpWebRequest request = (HttpWebRequest)WebRequest.Create(url);\r\n                request.ServicePoint.ConnectionLimit = 50;\r\n                request.Proxy = WebRequest.DefaultWebProxy;\r\n\r\n                request.UserAgent = <span style=\"color: #a31515;\">\"Opera/9.62 (Windows NT 5.1; U; en) Presto/2.1.1\"</span>;\r\n                request.Timeout = 10 * 1000;\r\n                request.ReadWriteTimeout = request.Timeout * 6;\r\n                request.Referer = <span style=\"color: #a31515;\">\"http://maps.google.com/\"</span>;\r\n                request.KeepAlive = <span style=\"color: blue;\">true</span>;\r\n\r\n                <span style=\"color: blue;\">using</span> (HttpWebResponse response = request.GetResponse() <span style=\"color: blue;\">as</span> HttpWebResponse)\r\n                {\r\n                    <span style=\"color: blue;\">using</span> (Stream responseStream = CopyStream(response.GetResponseStream()))\r\n                    {\r\n                        ret = FromStream(responseStream);\r\n                    }\r\n                }\r\n            }\r\n            <span style=\"color: blue;\">catch</span> (Exception)\r\n            {\r\n                ret = <span style=\"color: blue;\">null</span>;\r\n            }\r\n            <span style=\"color: blue;\">return</span> ret;\r\n        }\r\n    }\r\n\r\n    <span style=\"color: blue;\">class</span> Pass\r\n    {\r\n        <span style=\"color: blue;\">public</span> ImageSource src;\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">int</span> Y;\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">int</span> X;\r\n    }\r\n}\r\n\r\n</pre>\r\n</div>\r\n</p>",
    "PostedDate": "2011-04-03T13:00:27.69-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "591118",
    "ThreadId": "252329",
    "Html": "<p>please be more concrete ;}</p>",
    "PostedDate": "2011-04-03T23:40:23.213-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "591332",
    "ThreadId": "252329",
    "Html": "<p>Hi</p>\r\n<p>i create wpf control for streetview then use in windows application</p>\r\n<p>see this link</p>\r\n<p><a href=\"http://20uploads.com/files/1390/farvardin/6deb_StreetViewSample.zip\" target=\"_blank\">http://20uploads.com/files/1390/farvardin/6deb_StreetViewSample.zip</a></p>",
    "PostedDate": "2011-04-04T07:45:52.88-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "591807",
    "ThreadId": "252329",
    "Html": "<p>nice it works, so there is hosting element for wpf,&nbsp;<em>System.Windows.Forms.Integration.ElementHost</em></p>",
    "PostedDate": "2011-04-04T23:28:28.907-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "601083",
    "ThreadId": "252329",
    "Html": "<p>Hi,<br /><br />I've attemp several ways to incorporate streetview on a vs2008 windows form.<br /><br />Is there any way to do it or I'm attempting a impossible thing?<br /><br />I've seen that your wpf control is using FrameWork 4.<br /><br />Thanks</p>",
    "PostedDate": "2011-04-21T09:26:14.237-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "601381",
    "ThreadId": "252329",
    "Html": "<p>check he's example</p>",
    "PostedDate": "2011-04-21T22:26:03.377-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]