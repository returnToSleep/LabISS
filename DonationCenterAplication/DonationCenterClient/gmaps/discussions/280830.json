[
  {
    "Id": "703372",
    "ThreadId": "280830",
    "Html": "<p>Hi,</p>\n<p>I use a StreetViewToolTip for the CustomMarkerRed that open a popup (User control) and show some information and a thumbnail from StreetView.<br />The method to show the thumbnail&nbsp;is:</p>\n<div style=\"background-color: white; color: black;\">\n<pre>        <span style=\"color: blue;\">void</span> loadThumbnail(PointLatLng curPos)\r\n        {\r\n            <span style=\"color: blue;\">string</span> lat = curPos.Lat.ToString().Replace(<span style=\"color: #a31515;\">','</span>, <span style=\"color: #a31515;\">'.'</span>);\r\n            <span style=\"color: blue;\">string</span> lng = curPos.Lng.ToString().Replace(<span style=\"color: #a31515;\">','</span>, <span style=\"color: #a31515;\">'.'</span>);\r\n            <span style=\"color: blue;\">string</span> urlImg = String.Format(<span style=\"color: #a31515;\">\"http://cbk0.google.com/cbk?output=thumbnail&amp;w=300&amp;h=96&amp;ll={0},{1}\"</span>, lat, lng);\r\n            <span style=\"color: green;\">// Download web image</span>\r\n            System.Drawing.Image _Image = <span style=\"color: blue;\">null</span>;\r\n            _Image = DownloadImage(urlImg);\r\n\r\n            <span style=\"color: green;\">// check for valid image</span>\r\n            <span style=\"color: blue;\">if</span> (_Image != <span style=\"color: blue;\">null</span>)\r\n            {\r\n                BitmapImage bi = <span style=\"color: blue;\">new</span> BitmapImage();\r\n                bi.BeginInit();\r\n                MemoryStream ms = <span style=\"color: blue;\">new</span> MemoryStream();\r\n                _Image.Save(ms, ImageFormat.Bmp);\r\n                ms.Seek(0, SeekOrigin.Begin);\r\n                bi.StreamSource = ms;\r\n                bi.EndInit();\r\n                imgThumnail.Source = bi;\r\n            }\r\n        }\r\n</pre>\n</div>\n<p>I made a class that retrieve PanoId and the address from a PointLatLng:</p>\n<div style=\"background-color: white; color: black;\">\n<pre>    <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">class</span> StreetViewInf\r\n    {\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">string</span> PanoID { <span style=\"color: blue;\">get</span>; <span style=\"color: blue;\">set</span>; }\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">string</span> Address { <span style=\"color: blue;\">get</span>; <span style=\"color: blue;\">set</span>; }\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">string</span> Lat { <span style=\"color: blue;\">get</span>; <span style=\"color: blue;\">set</span>; }\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">string</span> Lng { <span style=\"color: blue;\">get</span>; <span style=\"color: blue;\">set</span>; }\r\n        <span style=\"color: blue;\">public</span> StreetViewInf(PointLatLng curPosition)\r\n        {\r\n            Lat=curPosition.Lat.ToString().Replace(<span style=\"color: #a31515;\">','</span>, <span style=\"color: #a31515;\">'.'</span>);\r\n            Lng=curPosition.Lng.ToString().Replace(<span style=\"color: #a31515;\">','</span>, <span style=\"color: #a31515;\">'.'</span>);\r\n            <span style=\"color: blue;\">string</span> urlSV = String.Format(<span style=\"color: #a31515;\">\"http://maps.google.com/cbk?output=xml&amp;ll={0},{1}\"</span>, Lat, Lng);\r\n            XDocument loaded = XDocument.Load(urlSV);\r\n            <span style=\"color: blue;\">var</span> xmlInf = <span style=\"color: blue;\">from</span> l <span style=\"color: blue;\">in</span> loaded.Descendants(<span style=\"color: #a31515;\">\"panorama\"</span>).Descendants(<span style=\"color: #a31515;\">\"data_properties\"</span>)\r\n                    <span style=\"color: blue;\">select</span> <span style=\"color: blue;\">new</span>\r\n                    {\r\n                        PanoID = (<span style=\"color: blue;\">string</span>)l.Attribute(<span style=\"color: #a31515;\">\"pano_id\"</span>),\r\n                        Address = String.Format(<span style=\"color: #a31515;\">\"{0}, {1}, {2}\"</span>, (<span style=\"color: blue;\">string</span>)l.Element(<span style=\"color: #a31515;\">\"text\"</span>), (<span style=\"color: blue;\">string</span>)l.Element(<span style=\"color: #a31515;\">\"region\"</span>), (<span style=\"color: blue;\">string</span>)l.Element(<span style=\"color: #a31515;\">\"country\"</span>))\r\n                    };\r\n            <span style=\"color: blue;\">var</span> inf = xmlInf.ElementAtOrDefault(0);\r\n            <span style=\"color: blue;\">if</span> (inf != <span style=\"color: blue;\">null</span>)\r\n            {\r\n                PanoID = inf.PanoID;\r\n                Address = inf.Address;\r\n            }\r\n        }\r\n    }\r\n\r\n</pre>\n</div>\n<p>This information can be pass for loading a Window like in Demo.StreetView project from Testing folder.</p>\n<p>In my project I open this window using a ContextMenu for CustomMarkerRed.</p>\n<p>I hope to be usefull for someone.</p>\n<p>Once again Thank You for sharing this project !</p>",
    "PostedDate": "2011-11-25T06:01:52.537-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]